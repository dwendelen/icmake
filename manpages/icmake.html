<!DOCTYPE html><html><head>
<meta charset="UTF-8">
<title>icmake</title>
<style type="text/css">
    figure {text-align: center;}
    img {vertical-align: center;}
</style>
<link rev="made" href="mailto:Frank B. Brokken: f.b.brokken@rug.nl">
</head>
<body text="#27408B" bgcolor="#FFFAF0">
<hr/>
<h1 id="title">icmake</h1>
<h2 id="author">icmake.8.00.05.tar.gz</h2>
<h2 id="date">1992-2015</h2>

<!DOCTYPE html><html><head>
<meta charset="UTF-8">
<style type="text/css">
    figure {text-align: center;}
    img {vertical-align: center;}
    figure {text-align: center;}
    img {vertical-align: center;}
</style>
<link rev="made" href="mailto:Frank B. Brokken: f.b.brokken@rug.nl">
</head>
<body text="#27408B" bgcolor="#FFFAF0">
<hr/>
<h1 id="title"></h1>

<!DOCTYPE html><html><head>
<meta charset="UTF-8">
<title>icmake(1)</title>
<style type="text/css">
    figure {text-align: center;}
    img {vertical-align: center;}
    figure {text-align: center;}
    img {vertical-align: center;}
    figure {text-align: center;}
    img {vertical-align: center;}
</style>
<link rev="made" href="mailto:Frank B. Brokken: f.b.brokken@rug.nl">
</head>
<body text="#27408B" bgcolor="#FFFAF0">
<hr/>
<h1 id="title">icmake(1)</h1>
<h2 id="author">icmake.8.00.05.tar.gz A program maintenance utility</h2>
<h2 id="date">1992-2015</h2>


<p>

<h2>NAME</h2>icmake - A program maintenance (<em>make</em>) utility using a
                    <strong>C</strong>-like grammar
<p>

<h2>SYNOPSIS</h2>
       <strong>icmake</strong> [options] <em>source[.im] [dest[.bim]]</em> [-- [args]]
<p>
<strong>icmun</strong> <em>bimfile</em>
<p>
<h2>DESCRIPTION</h2>
<p>
<strong>Icmake</strong>(1) can be used as an alternative to <strong>make</strong>(1). In its standard
operation mode, it calls the following programs:
    <ul>
        <li><em>icm-pp</em>  to preprocess the icmake file 
        <li><em>icm-comp</em>   to byte-code compile the <strong>icmake</strong>  <strong>s</strong>
        <li><em>icm-exec</em>   to execute the byte-code file
    </ul>
<p>
<strong>Icmake</strong> allows programmers to use a programming language (closely resembling
the well-known <strong>C</strong>-programming language) to define the actions that are
involved in (complex) program maintenance. For this, <strong>icmake</strong> offers various
special operators as well as a set of support functions that have proven to be
useful in program maintenance.
<p>
The program <strong>icmun</strong>(1) can be used to disassemble the compiled 
byte-code (.bim) file. <em>Icmun</em> is primarily used for illustration, education
and debugging.
<p>
Traditional make-utilities recompile sources once header files are
modified. In the context of <strong>C++</strong> program development this is often a bad
idea, as adding a new member to a class does not normally require you to
recompile the class's sources. To handle class dependencies in a more sensible
way, <strong>icmbuld</strong>(1) may inspect <em>CLASSES</em> files that can be used to define
dependencies among classes. By default, class-dependencies are not
interpreted. See also the <strong>icmconf</strong>(7) man-page for further details.
<p>
<h2>OPTIONS</h2>
<p>
<strong>Icmake</strong> uses the following files and options:
<p>
<ul>
    <li><em>source</em>: <strong>icmake</strong> script source file (default extension: <em>.im</em>).
    <li><em>dest</em>:  binary <strong>icmake</strong> script file (default:  <em>`source'.bim</em>).
    <li><em>--</em>:  <strong>icmake</strong> arguments separator for arguments passed to
            <em>icm-exec</em><br/> 
        <em>args</em>:  arguments following <em>--</em> are passed to <em>icm-exec</em> as-is
        as its arguments, and are available from <strong>icmake</strong>-sctipt's 
            <em>main()</em> function's <em>list argv</em> parameter (see below at
            section <strong>USER DEFINED FUNCTIONS</strong>).
    </ul>
<p>
the following options are available. The <em>-h</em> option overrules all other
options, the <em>-a</em> option overrules all other options except for <em>-h</em>. Of
the remaining action options (<em>-b, -c, -e, -i, -p</em> and <em>-t</em>) only one may
be specified:
    <ul>
    <li> <strong>-a</strong>  <br/>show information about <strong>icmake</strong>, overruled by <em>-h</em>
    <li> <strong>-b</strong>  <br/>discontinued. Option -e can be used instead
    <li> <strong>-c</strong>  <br/>the <strong>icmake</strong> source file is compiled
    <li> <strong>-e</strong>  <br/>execute the <strong>icmake</strong> .bim file, given as first argument
    <li> <strong>-F</strong>  <br/>the filenames and flags as well as an overview of all actions to
        be performed by <strong>icmake</strong> are shown on the standard output stream
    <li> <strong>-i</strong>  <br/>the first argument is the <strong>icmake</strong> source file, the default
        binary file is constructed if necessary and all additional
        arguments are passed to <em>icm-exec</em> `as is'.
    <li> <strong>-p</strong>  <br/>the <strong>icmake</strong> source file is only preprocessed, output is the
                preprocessed only the preprocessor is activated
    <li> <strong>-q</strong>  <br/>ignored
    <li> <strong>-T</strong>  <br/>this option must be provided with the name of a directory which
        is used to store temporary files. E.g., when compiling an <strong>icmake</strong>
        script, the output of <strong>icmake</strong>'s preprocessor is a temporary file which
        is removed on exit. By default <em>/tmp</em> is used, unless <em>/tmp</em> is
        not a writable directory, in which case the current user's <em>$HOME</em>
        directory is used. Implicit temporary filenames always start with the
        process id of the current <strong>icmake</strong> process.
    <li> <strong>-t</strong>  <br/>the argument following <em>-t</em> is the name of a temporary <em>.bim</em>
        file, which is removed after <strong>icmake</strong>'s call. The next argument is the
        name of the <strong>icmake</strong> script, and all additional arguments are passed as
        arguments to the <strong>icmake</strong> script. After making an <strong>icmake</strong>-script executable
        (<em>chmod +x script</em>), and providing it with an initial line like
        this: 
            <pre>

    #!/usr/bin/icmake -t /tmp/script
            
</pre>

        the script can directly be called:
            <pre>

    script arg1 arg2 
            
</pre>

        in which case the <strong>icmake</strong> script <em>`script'</em> is executed while it
        received the three arguments <em>script arg1 arg2</em>.
<p>
<li> <strong>-v</strong>  <br/>displays <strong>icmake</strong>'s version number, and ends <strong>icmake</strong>, 
            overruled by <em>-h</em>
    </ul>
<p>
<strong>Icmun</strong>:
<p>
<em>bimfile</em>:  binary <strong>icmake</strong> script file.
<p>
<h2>PREPROCESSOR DIRECTIVES</h2>
<p>
The following preprocessor directives are available:
    <ul>
    <li> comment:<br/>
       standard <strong>C</strong> comment (all between <em>/*</em> and <em>*/</em>) as well as
        comment-to-end-of-line (all line contents following <em>//</em>) are
        ignored.
<p>
<li> Shell startup: The first line of the <strong>icmake</strong>-script may start with
        <em>#!path</em>, where <em>path</em> defines the absolute location of the <strong>icmake</strong>
        program. By making the script executable, it can be called without
        explicitly calling <strong>icmake</strong>.  
<p>
E.g., if the first line of an (executable) icmakefile 'icm'
                  (without extension) contains
        <pre>

            #!/usr/bin/icmake -qi
        
</pre>

       then <em>icm</em> may be issued as a command, thus executing
        <pre>

            /usr/bin/icmake -qi icm ...
        
</pre>

       Alternatively, 
        <pre>

            #! /usr/bin/icmake -qt /tmp/icm
        
</pre>

       may be used, resulting in the execution of
        <pre>

            #! /usr/bin/icmake -qt /tmp/icm icm ...
        
</pre>

       In this case the binary file is removed on exit. The PID extension being
        the process-id of the <strong>icmake</strong> program executing <em>icm</em>.
    <li><em>#include "filename"</em><br/>
        The file <em>filename</em> is included at the location of the directive
    <li><em>#include &lt;filename&gt;</em><br/> The file <em>filename</em> is included at the
        location of the <em>#include</em> directive; <em>filename</em> is searched in
        the colon-separated directories specified by the <em>IM</em> environment
        variable. The first occurrence of <em>filename</em> in the directories
        specified by the <em>IM</em> environment variable is used.
    <li><em>#define identifier [definition]</em><br/> The text <em>identifier</em> will be
        replaced by <em>definition</em>. The definition may contain references to
        already defined identifiers, using the <em>${identifier}</em> format. If
        the <em>${identifier}</em> hasn't been defined (yet), the text
        <em>${identifier}</em> is literally kept. To prevent infinite recursion at
        most 100 <em>${identifier}</em> replacements are allowed.  
<p>
Definitions
        continue at the next line if the last character on a line is a
        backslash (<em>\</em>) (which is not included in the definition). Double
        quoted strings in definitions are kept as is. Multiple blanks in
        definitions are contracted to a single blank space.
<p>
A definition is optional. If omitted, the macro is defined, so it can
        be used in <em>#if(n)def</em> directives (see below), but in they are not
        replaced by any text in <strong>icmake</strong> code statements.
    <li><em>#ifdef identifier</em><br/>
        If the <em>identifier</em> macro was defined the next block of code (until
        a matching <em>#else</em> or <em>#endif</em> directive was detected) is
        byte-compiled. Otherwise, the block of code is ignored.
    <li><em>#ifndef identifier</em><br/> 
        If the <em>identifier</em> macro was <em>not</em> defined the next block of code
        (until a matching <em>#else</em> or <em>#endif</em> directive was detected) is
        byte-compiled. Otherwise, the block of code is ignored.
    <li><em>#else</em><br/>
        Terminates a <em>#ifdef</em> and <em>#ifndef</em> directive, reversing the
        acceptance decision about  the following code. Only one <em>#else</em>
        directive can be associated with <em>#if(n)def</em> directives.
    <li><em>#endif</em><br/>
        Terminates the preprocessor block starting at the matching 
        <em>#ifdef</em>, <em>#ifndef</em> or <em>#else</em> directive.
    <li><em>#undef identifier</em> <br/>
        Remove <em>identifier</em> from the set of defined symbols. This does not
        affect the specification of any previously defined symbols in which
        <em>identifier's</em> definition has been used. If <em>identifier</em> hasn't
        been defined a warning is issued.
    </ul>
<p>
<h2>DATA TYPES</h2>
<p>
<strong>Icmake</strong> supports three data types:
    <ul>
    <li><em>ASCII character constants</em><br/> 
       ASCII character constants consist of one character, surrounded by
        single or double quotes. Single characters (e.g., <em>'a'</em>) represent
        the character itself. Standard escape sequences (e.g., <em>'\n'</em>) are
        supported and represent their standard converted value (e.g., <em>'\n'</em>
        represents ascii value 10 (decimal)). Non-standard escape sequences
        (e.g., <em>'\x'</em>) represent the ascii character following the escape
        character (so <em>'\x'</em> equals <em>'x'</em>). Escape sequences consisting of
        three octal digits represent the ascii character corresponding to the
        octal value modulo 256 (e.g., <em>'\123'</em>). Escape sequences consisting
        of an x followed by two hexadecimal digits represent the ascii
        character corresponding to the hexadecimal value (e.g., <em>'\xa4'</em>).
<p>
<li><em>int</em><br/> 
       Integral values, ranging from <em>-0x8000</em> through <em>0x7fff</em>. <em>int</em>
        constants may be specified as decimal numbers (starting with digits 1
        through 9), octal numbers (starting with 0, followed by one or more
        octal digits) hexadecimal numbers (starting with 0x, followed by one
        or more hexadecimal digits) or as <em>ASCII</em> character constants.
<p>
<li><em>string</em><br/>
       Text variables. String constants are delimited by double
        quotes. Multiple string constants may be concatenated, but a single
        string constant may not extend over multiple lines. String constants
        separated by white space only (i.e., blanks, newlines, comment) are
        concatenated and represent one single string constant. To indicate an
        end-of-line in a string constant use the <em>\n</em> escape sequence.
<p>
ASCII character constants surrounded by double quotes can also be used
        in arithmetic expressions if one of the operands is an <em>int</em>. The
        single character string constant <em>must</em> be a constant, and cannot be
        a <em>string</em> variable.
<p>
Likewise, ASCII character constants surrounded by single quotes may be
        used in situations where a string operand is expected.
<p>
<li><em>list</em><br/>
       A data structure containing a series of individually accessible
        <em>string</em> values. When a list contains elements, its first element is
        indicated by index 0.
<p>
<li><em>void</em><br/>
       Used with function definitions to indicate that the function does not
        return a value.
    </ul>
<p>
Variables may be defined at the global level as well as at any local level
within functions. When defined inside functions, the standard <strong>C</strong> scoping
and visibility rules apply. E.g., local variables can only be used in their
own or in more deeply nested blocks, their visibility is masked in more deeply
nested blocks by defining an identically named variable inside those more
deeply nested blocks. Variables are strongly typed. A variable cannot have
type <em>void</em>.
<p>
Variables may be initialized once they are defined. Initializations can
use expressions, using predefined functions, constant values and values of
variables that are visible at the point of definition. 
<p>
<h2>PREDEFINED CONSTANTS</h2>
<p>
The following constants are predefined by <strong>icmake</strong>. All are constant <em>int</em> 
        values:
    <table>

        <td colspan=3><hr/></td>

        
<tr>
<td> symbol</td><td> value</td><td> intended for</td>
 
</tr>

        <td colspan=3><hr/></td>

        
<tr>
<td> O_ALL</td><td> 8</td><td> makelist</td>
 
</tr>

        
<tr>
<td> O_DIR</td><td> 2</td><td> makelist</td>
 
</tr>

        
<tr>
<td> O_FILE</td><td> 1</td><td> makelist</td>
 
</tr>

        
<tr>
<td> O_SUBDIR</td><td> 4</td><td> makelist</td>
 
</tr>

        <td colspan=3><hr/></td>

        
<tr>
<td> OFF</td><td> 0</td><td> echo</td>
 
</tr>

        
<tr>
<td> ON</td><td> 1</td><td> echo</td>
 
</tr>

        <td colspan=3><hr/></td>

        
<tr>
<td> P_CHECK</td><td> 0</td><td> system calls</td>
 
</tr>

        
<tr>
<td> P_NOCHECK</td><td> 1</td><td> system calls</td>
 
</tr>

        <td colspan=3><hr/></td>

        
<tr>
<td> S_IEXEC</td><td> 32</td><td> stat</td>
 
</tr>

        
<tr>
<td> S_IFCHR</td><td> 1</td><td> stat</td>
 
</tr>

        
<tr>
<td> S_IFDIR</td><td> 2</td><td> stat        </td>
 
</tr>

        
<tr>
<td> S_IFREG</td><td> 4</td><td> stat</td>
 
</tr>

        
<tr>
<td> S_IREAD</td><td> 8</td><td> stat        </td>
 
</tr>

        
<tr>
<td> S_IWRITE</td><td> 16</td><td> stat</td>
 
</tr>

        <td colspan=3><hr/></td>

    
</table>
<p>
The following constants are architecture dependent:
    <table>

        <td colspan=2><hr/></td>

        
<tr>
<td> symbol</td><td> 1 when defined on the platform, otherwise 0</td>
 
</tr>

        <td colspan=2><hr/></td>

        
<tr>
<td> unix</td>  <td> Unix, usually with GNU's gcc compiler</td>
 
</tr>

        
<tr>
<td> UNIX</td>  <td> may alternatively be available</td>
 
</tr>

        
<tr>
<td> linux</td> <td> x86 running Linux (usually with gcc)</td>
 
</tr>

        
<tr>
<td> LINUX</td>  <td> may alternatively be available</td>
 
</tr>

        
<tr>
<td> M_SYSV, M_UNIX</td> <td> x86 running SCO/Unix</td>
 
</tr>

        
<tr>
<td> _POSIX</td><td> _SOURCE   Unix with Posix compliant compiler</td>
 
</tr>

        
<tr>
<td> __hpux</td><td> HP-UX, with the native HP compiler</td>
 
</tr>

        <td colspan=2><hr/></td>

    
</table>
<p>
<h2>OPERATORS</h2>
<p>
<strong>int-typed operand(s):</strong>
<p>
All <strong>C</strong> operators (except for pointers, as <strong>icmake</strong> does not support
pointers) are supported, operating like their <strong>C</strong> counterparts on <em>int</em>
expressions.
<p>
<strong>string-typed operand(s):</strong>
<p>
For <em>string</em> type variables and/or values the following
operators are available:
    <ul>
    <li><em>a + b</em>: returns a new <em>string</em> value containing the concatenation of
<em>string</em> values <em>a</em> and <em>b</em>. Note that <em>string</em> constants may be
concatetated without using the <em>+</em> operator, e.g.,
        <pre>

    "hello "   "world"
    "hello " + "world"
        
</pre>

<p>
<li><em>a += b</em>: <em>a</em> must be a  <em>string</em> variable, to which the <em>string</em>
variable or value <em>b</em> is appended.
<p>
<li> string comparisons: operators <em>== != &lt;= &gt;= &lt; &gt; !=</em> and <em>==</em> may
be applied to <em>string</em> values or variables, returning 1 if the comparison
succeeds, otherwise 0. Comparison is case sensitively, and follows the
<em>ASCII</em> character set.
<p>
<li><em>!a</em>: the boolean <em>!</em> operator returns 1 if the <em>string a</em> is
empty, otherwise 0 is returned.
<p>
<li><em>a younger b, a newer b</em>: returns 1 if file <em>a</em> is more recent than
file <em>b</em>. E.g., <em>"source.cc" newer "source.o"</em>. If <em>b</em> doesn't exist, 1
is returned; if <em>a</em> doesn't exist 0 is returned; if neither <em>a</em> nor <em>b</em>
exists, 0 is returned; if they are of the same age, 0 is returned. Explicit
tests for the existence of a file can be performed using the <em>exists()</em>
predefined function (see below, section <strong>PREDEFINED FUNCTIONS</strong>).
<p>
<li><em>a older b</em>: turns 1 if file <em>a</em> is older than file <em>b</em>. E.g.,
<em>"libprog.a" older "source.o"</em>. If <em>a</em> doesn't exist, 1 is returned; if
<em>b</em> doesn't exist 0 is returned; if neither <em>a</em> nor <em>b</em> exists, 0 is
returned; if they are of the same age, 0 is returned.
<p>
<li><em>[]</em>: the index operator is defined as an alternative to the built-in
function <em>element</em>. It can only be applied (as holds true for <em>element()</em>
as well) as so-called <em>rvalue</em>. Therefore, constructions like:
        <pre>

        // assume str1 and str2 are strings
    str1 = str2[3]
        
</pre>

    will be accepted, but the following construction will not be accepted:
        <pre>

    str2[3] = str; // won't compile
        
</pre>

<p>
<li> The `backtick` operator (<em>`string cmd`</em>)<br/>
        A string placed between two backticks is executed by the <em>popen</em>(3)
        function. The standard output gererated by the command that is stored
        in the string argument is returned as a list. An empty list indicates
        that the command could not be executed. A command that could be
        executed but did not produce any output returns a list containing one
        empty element. The command's standard error stream output is not
        automatically collected. Standard shell redirection could be used to
        collect the standard error stream's output as well. Example:
            <pre>

        string s = "ls";
        printf(`s`);        // prints the elements in the current
                            // directory
            
</pre>

        The predefined function <em>eval(string cmd)</em> behaves exactly like the
        backtick operator: they are synonyms.
    </ul>
<p>
<strong>list-typed operand(s):</strong>
<p>
For <em>list</em> type variables and/or values the following
operators are available:
    <ul>
    <li><em>a + b</em>: returns a new <em>list</em> value containing the concatenation of
<em>list</em> values <em>a</em> and <em>b</em>. This is <em>not</em> a set operation: if an
element appears both in <em>a</em> and in <em>b</em>, they will appear twice in the
resulting list.
<p>
<li><em>a - b</em>: returns a new <em>list</em> value containing the elements in <em>a</em>
that are not present in <em>b</em>. This <em>is</em> a set operation.
<p>
<li><em>a += b</em>: elements in <em>b</em> are added to the elements in <em>a</em>, which 
must be a  <em>list</em> variable.  This is <em>not</em> a set operation.
<p>
<li><em>a -= b</em>: elements in <em>b</em> are removed from the elements in <em>a</em>,
which must be a <em>list</em> variable.  This <em>is</em> a set operation.
<p>
<li> list equality comparisons: operators <em>!=</em> and <em>==</em> may be applied
to <em>list</em> values or variables. Operator <em>==</em> returns 1 if both lists have
element-by-element identical elements, 0 otherwise. Operator <em>!=</em> reverses
the result of <em>==</em>.
<p>
<li><em>!a</em>: the boolean <em>!</em> operator returns 1 if the <em>list a</em> is
empty, otherwise 0 is returned.
<p>
<li><em>[]</em>: the index operator is defined as an alternative to the built-in
function <em>element</em>. It can only be applied (as holds true for <em>element()</em>
as well) as so-called <em>rvalue</em>. Therefore, constructions like:
        <pre>

        // assume lst is a list, str is a string
    str = lst[3]
        
</pre>

    will be accepted, but the following construction will not be accepted:
        <pre>

    lst[3] = str; // won't compile
        
</pre>

    </ul>
<p>
<strong>Casting:</strong>
<p>
Type-casts may be performed using the standard <strong>C</strong> cast-operator to
cast:
    <ul>
    <li> Strings to ints and vice versa (<em>(int)"123", (string)55</em>)
    <li> Strings may be cast to lists (<em>list lst = (list)"hello"</em>)
    </ul>
<p>
<h2>FLOW CONTROL</h2>
<p>
<strong>Icmake</strong> offers the following subset of <strong>C</strong>'s statement types. They can be
used as in the <strong>C</strong> programming language.
    <ul>
    <li><em>expression ;</em><br/>
        The plain expression statement;
<p>
<li> The compound statement <br/>
        Variables of any type may be defined and initialized anywhere inside
        any compound statement. The <em>visibility</em> of a variable starts at its
        point of definition.
<p>
<li><em>if (condition) statement</em><br/>
        A variable may be defined and initialized within the condition. E.g,
            <pre>

    if (string str = getText())
        process(str);
            
</pre>

        In this example, <em>process</em> is not called if <em>getText()</em> returns an
        empty string. The variable <em>str</em> does not exist either before or
        after the <em>if</em> statement.
<p>
<li><em>if (condition) statement else statement</em><br/>
        As with the previous statement, a variable may be defined and
        initialized within the condition. 
<p>
<li><em>for (init; condition; increment) statement</em><br/> 
       Variables (of a single type) may be initialized (and optionally be
        defined) in the <em>init</em> section. The <em>init</em>, <em>condition</em> and
        <em>increment</em> sections may be left empty. The empty condition section
        is interpreted as `always <em>true</em>'.
<p>
<li><em>while (condition) statement</em><br/>
        A variable may be defined and initialized within the condition.<br/>
        A complementary  <em>do ... while()</em> statement is not available.
<p>
<li><em>return</em><br/>
       Plain <em>return</em> statements can be used for <em>void</em> functions,
        and <em>return expression</em> statements are used for other
        functions. The function <em>main</em> by default returns 0; other functions
        do not use default return values.
<p>
<li><em>break</em><br/>
        To leave <em>for</em> and <em>while</em> statements, overruling the statement's
        condition.
<p>
<li><em>continue</em><br/>
        To continue with the next iteration of a <em>for</em> or <em>while</em>
        statement.
<p>
<li><em>exit(expression)</em><br/>
       To end the execution of an <strong>icmake</strong>-script. The <em>expression</em> must
        evaluate to an <em>int</em> value, which becomes the script's exit value.
    </ul>    
<p>
<h2>PREDEFINED FUNCTIONS</h2>
<p>
<strong>Icmake</strong> offers the following predefined functions, which can be used
anywhere in <strong>icmake</strong> scripts. The function overview is ordered alphabetically
by function name.
<p>
<ul>
    <li><em>void arghead(string h)</em><br/>
       Helper function of <em>exec()</em> (see also below at <em>exec()</em>):
        defines the `argument head', to be used with <em>exec()</em>. By default,
        the `argument head' is an empty string.
<p>
<li><em>void argtail (string t)</em><br/>
       Helper function of <em>exec()</em> (see also below at <em>exec()</em>): defines
        the `argument tail', to be used with <em>exec()</em>. By default, the
        `argument tail' is an empty string.
<p>
<li><em>int ascii(string s)</em><br/>
        Returns the first character of <em>s</em> as an int; e.g.,
        <em>ascii("A")</em> returns 65;
<p>
<li><em>string ascii(int i)</em><br/>
        Returns <em>i</em> as a string, e.g., <em>ascii(65)</em> returns the string
        <em>"A"</em>;
<p>
<li> The `backtick` operator (<em>`</em>)<br/>
        A string placed between two backticks is executed by the <em>popen</em>(3)
        function. The standard output gererated by the command that is stored
        in the string argument is returned as a list. An empty list indicates
        that the command could not be executed. A command that could be
        executed but did not produce any output returns a list containing one
        empty element. The command's standard error stream output is not
        automatically collected. Standard shell redirection could be used to
        collect the standard error stream's output as well. Example:
            <pre>

        string s = "ls";
        printf(`s`);        // prints the elements in the current
                            // directory
            
</pre>

        The predefined function <em>eval(string cmd)</em> behaves exactly like the
        backtick operator: they are synonyms.
<p>
<li><em>string change_base(string file, string newbase)</em><br/>
        Changes the basename of <em>file</em>, returns the changed name. E.g, 
        <em>change_base("/path/demo.im", "out")</em> returns <em>"/path/out.im"</em>;
<p>
<li><em>string change_ext(string file, string newext)</em><br/>
        Changes the extension of <em>file</em>, returns the changed name. E.g, 
        <em>rss_changeExt("source.cc", "o")</em> returns <em>"source.o"</em>;
<p>
<li><em>string change_path(string file, string newpath)</em><br/>
         Changes the path specification of <em>file</em>, returns the changed name.
        E.g, <em>change_path("tmp/binary", "/usr/bin")</em> returns 
        <em>"/usr/bin/binary"</em>. Note that the <em>/</em>-separator is inserted if
        required. 
<p>
<li><em>string chdir(string newdir)</em><br/>
       Changes the script's working directory, returns the previous dir as an
        absolute path.<br/>
       Use <em>chdir(".")</em> to get current working directory, <em>chdir("")</em> may
        be used to obtain the startup working directory (this functionality
        was broken in releases before than 7.00, but is now operational). The
        function terminates the <strong>icmake</strong>-script if the specified <em>newdir</em> does
        not exist.
<p>
<li><em>string chdir(int checking, string newdir)</em><br/>
       Same functionality as the previous function, but by specifying
        <em>checking</em> as <em>P_NOCHECK</em>. the function won't terminate the
        script. Rather, it will return the script's current working directory.
<p>
<li><em>cmdhead(string h)</em><br/>
       Helper function of <em>exec()</em> (see also below at <em>exec()</em>):
        Defines a `command head', to be used with <em>exec()</em>. By default,
        the `command head' is an empty string.
<p>
<li><em>cmdtail(string t)</em><br/>
       Helper function of <em>exec()</em> (see also below at <em>exec()</em>):
        Defines a `command tail', to be used with <em>exec()</em>. By default,
        the `command tail' is an empty string.
<p>
<li><em>echo(int opt)</em><br/> 
       Controls echoing of called programs (and their arguments), specify
        <em>OFF</em> if echoing is not requested. By default <em>ON</em> is active.
<p>
<li><em>string element(int index, list lst)</em><br/>
       Returns string <em>index</em> (0-based) from <em>lst</em>. An empty string is
        returned if an unavailable index value is provided. See also the
        <em>[]</em> operator in the section <strong>OPERATORS</strong>.
<p>
<li><em>string element(int index, string str)</em><br/>
       Returns character <em>index</em> (0-based) from <em>str</em>. An empty string is
        returned if an unavailable index value is provided. See also the
        <em>[]</em> operator in the section <strong>OPERATORS</strong>.
<p>
<li><em>list eval(string str)</em><br/>
       This function acts identically to the backtick operator. The example
        shown at the description of the backtick operator could therefore also
        have been written like this:
       <pre>
 
    printf(eval("ls")); // prints the elements in the current 
                        // directory 
        
</pre>

<p>
<li><em>exec(string cmd, ...)</em><br/>
       Executes command with arguments. Each argument will be prefixed by
        <em>arghead()</em>'s argument and postfixed by <em>argtail()</em>'s
        argument. Note that no blanks are inserted between <em>arghead()</em>'s
        contents, the argument proper, and <em>argtail()</em>'s argument. All thus
        modified arguments are concatenated, this time separated by single
        blanks, and then <em>cmdhead()</em>'s contents are inserted between the
        command and the first argument (on either side delimited by single
        blanks) and <em>cmdtail()</em>'s contents are appended to the arguments
        (again, separated by a single blank). <em>PATH</em> is searched to locate
        <em>cmd</em>. 0 is returned.
<p>
<li><em>exec(int checkcmd, string cmd, ...)</em><br/>
       Same functionality as the previous function, but by specifying
        <em>checking</em> as <em>NOT_CHECKED</em> the function won't terminate the
        script. Rather, it will return the called command's exit status, or
        <em>0x7f00</em> if the command wasn't found.
<p>
<li><em>execute(string cmd, string cmdhd,
            string arghd, ..., string argtl, string cmdtl)</em><br/>
       Same as <em>exec()</em>, but command head/tail and argument
        head/tail must be specified. 
        The actually executed command starts with <em>cmd</em>, followed by 
        <em>cmdhd</em>. Next is a series of arguments follows, each 
        enclosed by <em>arghd</em> and <em>argtl</em>. The command terminates 
        with <em>cmdtl</em>. 0 is returned
<p>
<li><em>execute(int checking, string cmd, string cmdhd,
            string arghd, ..., string argtl, string cmdtl)</em><br/>
       Same functionality as the previous function, but by specifying
        <em>checking</em> as <em>NOT_CHECKED</em> the function won't terminate the
        script. Rather, it will return the called command's exit status, or
        <em>0x7f00</em> if the command wasn't found.
<p>
<li><em>int exists(string file)</em><br/>
       Returns a non-zero value if <em>file</em> exists, otherwise 0 is returned. 
<p>
<li><em>list fgets(string file, list offset)</em><br/>
       <strong>NOTE:</strong> the prototype of this function changed from 
        <em>fgets(string file, int offset)</em> to <em>fgets(string file, list
            offset)</em> at version 8.00.00.<br/>
<p>
The next line found at offet <em>offset</em> is read from <em>file</em>.  It
        returns a list <em>retlist</em> containing as its first element the
        contents of the read line (without the <em>\n</em> line terminator), as its
        second element the line's terminator `<em>\n</em>' (if encountered), and as
        its third element the string <em>OK</em> if a line was successfully read,
        <em>FAIL</em> if reading from file failed. At EOF an empty list is
        returned. The list may contain additional elements, which are
        internally used by <em>fgets</em>.<br/>
<p>
To read multiple lines, start by passing an empty list as <em>gets's</em>
        second argument. To read subsequent lines, pass the previously
        returned list to <em>fgets's</em> second argument.
<p>
Here is an example showing how to read a complete file:
            <pre>

        list ret;
        while (1)
        {
            ret = fgets("filename", ret);
            if (!ret)
                break;
            process(ret[0], ret[1]);
        }
            
</pre>

<p>
<li><em>int fprintf(string filename, ...)</em><br/>
       Appends all (comma separated) arguments to the file
        <em>filename</em>. Returns the number of printed arguments.
<p>
<li><em>int fprintf(string filename, string format, ...)</em><br/>
       Appends all (comma separated) arguments to the file
        <em>filename</em>. Returns the number of printed arguments.<br/>
       If <em>format</em> contains placeholders %1 .. %n the output is
            formatted (see also <em>strformat</em>). Note that in this case
            argument counting (also) starts beyond the format string: the
            first argument following <em>format</em> is referred to as <em>%1</em>.
<p>
<li><em>string get_base(string file)</em><br/>
        Returns the base name of <em>file</em>. The base name is the file without
        its path prefix and without its extension. The extension is all
        information starting at the final dot in the filename. If no final dot
        is found, the file name is the base name. E.g., the base name of
        <em>a.b</em> equals <em>a</em>, the base name of <em>a.b.c</em> equals <em>a.b</em>, the
        base name of <em>a/b/c</em> equals <em>c</em>. 
<p>
<li><em>string getch()</em><br/>
        Returns the next pressed key as a string (no `Enter' required for
        ms-dos and unix (incl. linux) systems).
<p>
<li><em>string get_dext(string file)</em><br/>
       Returns the extension of <em>file</em>, including the separating dot. The
        extension is all information starting at the final dot
        in the filename. 
<p>
If no final dot is found, an empty string is returned.
<p>
<li><em>list getenv(string envvar)</em><br/>
       Returns the value of environment variable <em>envvar</em> in a list
        containing two elements:
<p>
the first element indicates whether the environment variable was
        defined (value <em>"1"</em>) or not (value <em>"0"</em>);<br/> the second element
        indicates the value of the environment variable.
<p>
Enivironment variables are of the form <em>variable=value</em>, and if
        defined the list's second element contains <em>value</em>. If the value is
        empty, the variable is defined, but has no text associated with it.
<p>
<li><em>string get_ext(string file)</em><br/>
       Returns the extension of <em>file</em>, except for the separating dot. The
        extension is all information starting at the final dot
        in the filename. 
<p>
If no final dot is found, an empty string is returned.
<p>
<li><em>int getpid()</em><br/>
        Returns the process-id (UNIX) of the icmake byte
        code interpreter <strong>icm-exec</strong>.
<p>
<li><em>string gets()</em><br/>
        Returns the next line read from the keyboard as a <em>string</em>. The line
        entered on the keyboard must be terminated by an `Enter' key, which is
        not stored in the returned string.
<p>
<li><em>string get_path(string file)</em><br/> 
       Returns the path-prefix of <em>file</em>. The path prefix is all information
        up to (and including) the final directory separator (which is,
        depending on the operating system, a forward- or backslash).
<p>
If no path is found, an empty strring is returned.
<p>
<li><em>int listlen(list l)</em><br/>
        Returns the number of elements in <em>list</em>.
<p>
<li><em>list makelist(string mask)</em><br/>
        Returns a list of all files matching <em>mask</em>. E.g.,
        <em>makelist("*.c")</em> returns a list containing all files ending in
        <em>.c</em>. 
    <li><em>list makelist(type, string mask)</em><br/>
        Same as the previous function, but the type of the directory elements
        may be specified as its first argument:
    <table>

        <td colspan=0><hr/></td>

        
<tr>
<td> symbol</td><td> meaning</td> 
</tr>

        <td colspan=0><hr/></td>

        
<tr>
<td> IS_ALL</td><td> obtain all directory entries</td> 
</tr>

        
<tr>
<td> IS_DIR</td><td> obtain all directories, including . and ..</td> 
</tr>

        
<tr>
<td> IS_FILE</td><td> obtain a list of files</td> 
</tr>

        
<tr>
<td> IS_SUBDIR</td><td> obtain all subdirectories</td> 
</tr>

        <td colspan=0><hr/></td>

    
</table>
    Note that the pattern <em>*</em> will not match hidden entries under Unix-type
        operating systems. Use <em>.*</em> for that.
<p>
<li><em>list makelist(string mask, newer, string comparefile)</em><br/>
        Returns list of all files matching mask which are newer
        than a provided comparefile. Operator <em>younger</em> may be used instead
        of <em>newer</em>. Note that <em>newer</em> and <em>younger</em> are operators, not
        strings. 
<p>
<li><em>list makelist([int = IS_FILE,] string mask, newer,
             string comparefile)</em><br/>
        Same as the previous function, but <em>type</em> may be specified as in
        <em>list makelist(type, string mask)</em>.
<p>
<li><em>makelist(string mask, older, string comparefile)</em><br/>
        See above; returns a list of files that are older than the 
        comparefile.
<p>
<li><em>makelist(type, string mask, older, string comparefile)</em><br/>
        Same as the previous function, but <em>type</em> may be specified as in
        <em>list makelist(type, string mask)</em>.
<p>
<li><em>int printf(...)</em><br/>
       Shows all (comma separated) arguments to screen (i.e., the standard
        output stream). Returns the number of printed arguments.
<p>
<li><em>int printf(string format, ...)</em><br/>
       Shows all (comma separated) arguments to screen (i.e., the standard
        output stream). Returns the number of printed arguments (the
        <em>format</em> string counts as one argument).<br/>
       If <em>format</em> contains placeholders %1 .. %n the output is 
            formatted (see also <em>strformat</em>).
<p>
<li><em>int putenv(string envvar)</em><br/>
        Adds <em>envvar</em> to the current (<strong>icmake</strong>) environment
        Use the format: "VAR=value". Returns 0.
<p>
<li><em>string resize(string str, int newlength)</em> 
       Returns a copy of string <em>str</em>, resized to <em>newlength</em> characters.
        If <em>newlength</em> is negative then an empty string is returned, if
        <em>newlength</em> exceeds <em>str's</em> length then the newly added characters
        are initialized to blank spaces.
<p>
<li><em>int sizeof(list l)</em><br/>
        Deprecated: use <em>listlen</em>.
<p>
<li><em>int sizeoflist(list l)</em><br/>
        Deprecated: use <em>listlen</em>.
<p>
<li><em>list stat(string entry)</em><br/>
        Returns <strong>stat</strong>(2) information of directory entry <em>entry</em> as 
        a list. The returned list has two elements: element 0 is the
        <em>attribute value</em>, element 1 contains the size of the file.
<p>
Attributes are  returned as bit-flags, composed from the
        following predefined constants: 
        <pre>

            S_IFCHR     S_IFDIR     S_IFREG
            S_IREAD     S_IWRITE    S_IEXEC
        
</pre>

        See the <strong>stat</strong>(2) manual page for the meanings of these constants.
<p>
<li><em>list stat(checking, string entry)</em><br/>
       Same as the previous function, but by specifying <em>checking</em> as
        <em>P_NOCHECK</em> the function won't terminate the script. Rather, it 
        returns <strong>stat</strong>(2)'s return value.
<p>
<li><em>int strlen(string s)</em><br/>
        Returns the number of characters in <em>s</em> (not counting the final 0).
<p>
<li><em>int strfind(string haystack, string needle)</em><br/>
        Returns index in <em>haystack</em> where <em>needle</em> is found, or -1 if 
        <em>needle</em> is not contained in <em>haystack</em>.<br/>
        <strong>This function was called strstr() in versions before 7.00</strong>.
<p>
<li><em>int strformat(string format,...)</em><br/>
        Returns a formatted string using placeholders %1 .. %2 to address
        arguments following format.<br/> 
        Example:<br/>
        <pre>

void main()
{
    int i = 10;
    int j = 20;
    string s1;
    string s2;
                                    // traditional approach:
    s1 = (string)i + " " + (string)j + " " + (string)i;
                                    // using strformat:  
    s2 = strformat("%1 %2 %1", i, j);
    printf("s1 = %1, s2 = %2\n", s1, s2);
}
        
</pre>

<p>
<li><em>string strlwr(string s)</em><br/>
        Returns a lower-case duplicate of <em>s</em>.
<p>
<li><em>list strtok(string str, string separators)</em><br/>
        Returns a list containing all substrings of <em>str</em> separated by one
        or more (consecutive) characters in <em>separators</em>. E.g.,
        <em>strtok("hello icmake's+world", " +")</em> returns the list containing
        the three strings <em>"hello"</em>, <em>"icmake's"</em>, and <em>"world"</em>.
<p>
<li><em>string strupr(string s)</em><br/>
        Returns an upper-case duplicate of <em>s</em>.
<p>
<li><em>string substr(string text, int offset, int count)</em><br/>
        Returns a substring of <em>text</em>, starting at <em>offset</em>, consisting of
        <em>count</em> characters. If <em>offset</em> exceeds (or equals) the string's
        size or if <em>count &lt;= 0</em>, then an empty string is returned. If
        <em>offset</em> is less than 0 then 0 is used. 
<p>
<li><em>int system(string command)</em><br/>
       Executes <em>command</em>. The return value indicates the executed
        command's exit value. The string <em>command</em> may contain redirection
        and/or piping characters.
<p>
<li><em>int system(int checking, string command)</em><br/>
       Same functionality as the previous function, but by specifying
        <em>checking</em> as <em>NOT_CHECKED</em> the function won't terminate the
        script. Rather, it will return the called command's exit status, or
        <em>0x7f00</em> if the command wasn't found.
<p>
<li><em>string trim(string s)</em><br/>
        Returns a copy of <em>s</em> without leading and trailing white spaces.
<p>
<li><em>string trimleft(string str)</em><br/>
        Returns a copy of <em>s</em> without leading white spaces.
<p>
<li><em>string trim(string s)</em><br/>
        Returns a copy of <em>s</em> without trailing white spaces.
    </ul>
<p>
<h2>USER DEFINED FUNCTIONS</h2>
<p>
<strong>void main</strong>
<p>
<strong>Icmake</strong> scripts must be provided with a user-defined function <em>main</em>. The
function <em>main</em> has three optional parameters, which may be omitted from the
last one (<em>envp</em>) to the first (<em>argc</em>), like in <strong>C</strong>. Its full prototype
is (note: <strong>void</strong> return type):
        <pre>

    void main(int argc, list argv, list envp)
        
</pre>

    In <em>main()</em>,
    <ul>
    <li><em>argc</em> represents the number of elements in <em>argv</em>;
<p>
<li><em>argv</em> contains the arguments, with element 0 the compiled <strong>icmake</strong> script
(the `<em>.bim</em>' file);
<p>
<li><em>envp</em> contains the `environment' variables. The function <em>listlen</em>
can be used to determine the number of its elements. Elements in <em>envp</em> have
the form <em>variable=value</em>. Alternatively, the function <em>getenv</em> can be
used to retrieve a specific environment variable immediately.
    </ul>
    Example:
        <pre>

    void main(int argc, list argv)
    {
        list toCompile;
        int idx;

        if (argc == 1)
            usage(element(0, argv));

        if (toCompile = altered("*.cc"))
        {
            for (idx = length(toCompile); idx--; )
                compile(element(idx, toCompile));

            if (getenv("dryrun")[0] == "0")
                linking(element(2, argv));
        }
        exit (0);
    }    
        
</pre>

<p>
Having initialized all global variables in order of their definitions <em>main</em>
is called by <strong>icmake</strong>'s run-time support system to perform additional
tasks. 
<p>
<strong>Additionally defined user functions</strong>
<p>
Additional functions may be defined. Once defined, these functions can
be called. Forward referencing of either variables or functions is not
supported, but recursively calling functions is. As function declarations are
not supported indirect recursion is not supported either.
<p>
User-defined functions must have the following elements:
    <ul>
    <li> The function's return type. One of the available types must be
used explicitly, e.g., <em>void</em>. There is no default type. 
<p>
<li> The function's name, e.g., <em>compile</em>.
<p>
<li> A parameter list, defining zero or more comma-separated
parameters. The parameters themselves consist of a type name followed by the
parameter's identifier. E.g., <em>(string outfile, string source)</em>.
<p>
<li> A <em>body</em> surrounded by a pair of curly braces (<em>{</em> and <em>}</em>).
    </ul>
<p>
Function bodies may contain (optionally initialized) variable
definitions. Variable definitions start with a type name, followed by one or
more comma separated (optionally initialized) variable identifiers.  If a
variable is not explicitly initialized it is initialized by default. By
default an <em>int</em> variable is initialized to 0, a <em>string</em> is initialized
to an empty string (<em>""</em>) and a <em>list</em> is initialized to a list of zero
elements.
<p>
In addition to variable definitions, bodies may contain zero or more
statements (cf. section <strong>FLOW CONTROL</strong>). Note that variables may be defined
(and optionally initialized) anywhere inside functions, and also in <em>if,
for</em> and <em>while</em> statements.
<p>
<h2>FILES</h2>
<p>
The mentioned paths are sugestive only and may be installation dependent:
    <ul>
    <li> <strong>/usr/bin/icmake</strong>: the main <strong>icmake</strong> program;
    <li> <strong>/usr/bin/icmun</strong>: the <strong>icmake</strong> unassembler;
    <li> <strong>/usr/lib/icm-pp</strong>: the preprocessor called by <strong>icmake</strong>;
    <li> <strong>/usr/lib/icm-comp</strong>: the compiler called by <strong>icmake</strong>;
    <li> <strong>/usr/lib/icm-exec</strong>: the byte-code interpreter called by <strong>icmake</strong>;
    </ul>
<p>
<h2>EXAMPLES</h2>
<p>
The distribution (usually in <em>/usr/share/doc/icmake</em>) contains a
directory <em>examples</em> containing various examples of <strong>icmake</strong> script. Note in
particular the <em>examples/icmbuild</em> subdirectory containing a general script
for <strong>C++</strong> and <strong>C</strong> program maintenance.
<p>
<h2>SEE ALSO</h2>
    <strong>icmbuild</strong>(1), <strong>icmconf</strong>(7), 
    <strong>icmstart</strong>(1), <strong>icmstart.rc</strong>(7), <strong>make</strong>(1)
<p>
<h2>BUGS</h2>
    Standard comment starting  on lines containing preprocessor directives
        may not extend over multiple lines.
<p>
<h2>COPYRIGHT</h2>
    This is free software, distributed under the terms of the 
    GNU General Public License (GPL).
<p>
<h2>AUTHOR</h2>
    Frank B. Brokken (<strong>f.b.brokken@rug.nl</strong>).
<p>
