#!/bin/bash

action=$1
if [ "$action" == "distclean" ] ; then
    echo rm -rf tmp
    rm -rf tmp
    action=clean
fi

if [ "$action" == "clean" ] ; then
    for dir in rss icm-comp icm-exec icm-pp icmun icmake
    do
        cd $dir
	echo -n "cd $dir; "
        build clean
        cd ..
    done
    exit 0
fi

if [ ! -e tmp/INSTALL.im ] ; then

    if [ "$action" == "" ] ; then
        echo "
First run ./icm_prepare, specifying a base directory for icmake, or restart 
$0, and specify a base directory as its first command-line argument
"
        exit 1;
    fi

    ./icm_prepare $action
fi

for dir in rss icm-comp icm-exec icm-pp icmun
do
    cd $dir
    echo $dir
    build || exit 1
    cd ..
done




